@model IndexModel;

@{
    ViewData["Title"] = "Home Page";
    var products = Model.Products;
}

<div class="text-center">
    <table>
        <tr>
            <th>ID</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Цена за штуку</th>
            <th>Количество</th>
            <th>Действие</th>
        </tr>
        @for (int i = 0; i < products.Count; i++)
        {
            <tr>
                <td>@products[i].ID</td>
                <td><div id="category_text_@i">@products[i].Category</div></td>
                <td><div id="description_text_@i">@products[i].Description</div></td>
                <td><div id="price_text_@i">@products[i].Price</div></td>
                <td><div id="quantity_text_@i">@products[i].Quantity</div></td>
                <td>
                    <div id="view_actions_@i">
                        <button onclick="onEditClick(@i)">✎</button>
                        <a href="@Url.Action("DeleteProduct", "Home", new { id = products[i].ID })">⌫</a>
                    </div>
                    
                    <div id="edit_actions_@i" style="display: none">
                        <button onclick="onSaveClick(@i)">✔</button>
                        <button onclick="onCancelClick(@i)">✖</button>
                    </div>
                </td>
            </tr>
        }
    </table>
    <h3>Новый продукт:</h3>
    <form action="@Url.Action("CreateProduct", "Home")" method="post">
        Category:<br/>
        <input type="text" name="Category" value=""/><br/>
        Description:<br/>
        <input type="text" name="Description" value=""/><br/>
        Price:<br/>
        <input type="number" name="Price" value=""/><br/>
        Quantity:<br/>
        <input type="number" name="Quantity" value=""/><br/>
        <input type="submit" name="Create"/><br/>
    </form>
</div>
<script>
    function onEditClick(i) 
    {
        replaceTextWithInput(`category_text_${i}`);
        replaceTextWithInput(`description_text_${i}`);
        replaceTextWithInput(`price_text_${i}`);
        replaceTextWithInput(`quantity_text_${i}`);

        SwitchToEditMode(i);

    }
    
    function replaceTextWithInput(containerId)
    {
        var nameText = document.getElementById(containerId);
        var originalValue = nameText.innerText;
        var nameInput = document.createElement("input");
        nameInput.id = containerId.replace("_text_", "_input_");
        nameInput.value = nameText.innerText;
        
        nameInput.dataset.originalValue = originalValue;
        
        nameText.innerHTML = "";
        nameText.appendChild(nameInput);
    }
    
    function SwitchToEditMode(i)
    {
        document.getElementById(`view_actions_${i}`).style.display = "none";
        document.getElementById(`edit_actions_${i}`).style.display = "block";
    }
    
    function onSaveClick(i)
    {
        saveText(`category_text_${i}`);
        saveText(`description_text_${i}`);
        saveText(`price_text_${i}`);
        saveText(`quantity_text_${i}`);

        switchToViewMode(i);
    }
    
    function onCancelClick(i)
    {
        restoreText(`category_text_${i}`);
        restoreText(`description_text_${i}`);
        restoreText(`price_text_${i}`);
        restoreText(`quantity_text_${i}`);

        switchToViewMode(i);
    }

    function switchToViewMode(i)
    {
        document.getElementById(`edit_actions_${i}`).style.display = "none";
        document.getElementById(`view_actions_${i}`).style.display = "block";
    }
    
    function restoreText(containerId)
    {
        var nameText = document.getElementById(containerId);
        var nameInput = nameText.querySelector("input");
        
        nameText.innerText = nameInput.dataset.originalValue;
    }

    function saveText(containerId)
    {
        var nameText = document.getElementById(containerId);
        var nameInput = nameText.querySelector("input");

        nameText.innerText = nameInput.value;
    }

</script>